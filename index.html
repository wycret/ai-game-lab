<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ¸¸æˆç›ˆåˆ©ç³»ç»Ÿ</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- å¼•å…¥ React å’Œ ReactDOM UMD ç‰ˆæœ¬ï¼Œç¡®ä¿å…¨å±€å˜é‡å¯ç”¨ -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <style>
        /* è®¾ç½®å…¨å±€å­—ä½“å’ŒèƒŒæ™¯ï¼Œå¢å¼ºè§†è§‰æ•ˆæœ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* æ²‰ç¨³çš„æ·±è“è‰²èƒŒæ™¯ */
            color: #e2e8f0;
        }
        /* ç¡®ä¿è‡ªå®šä¹‰ alert æ ·å¼å¯ä»¥è¦†ç›– */
        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background: #1f2937;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            max-width: 80%;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="root">
        <!-- React åº”ç”¨å°†åœ¨æ­¤å¤„æ¸²æŸ“ -->
    </div>

    <!-- è‡ªå®šä¹‰ Alert æ›¿ä»£æµè§ˆå™¨çš„ alert() -->
    <div id="custom-alert-container"></div>
    <script type="text/javascript">
        // Overrides the native alert() function to use a custom UI
        window.alert = function (message) {
            const container = document.getElementById('custom-alert-container');
            const alertBox = document.createElement('div');
            alertBox.className = 'custom-alert';
            alertBox.innerHTML = `
                    <p class="text-white text-lg mb-4">${message}</p>
                    <button
                        onclick="this.parentNode.remove()"
                        class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded transition duration-150"
                    >
                        ç¡®è®¤
                    </button>
                `;
            container.appendChild(alertBox);
        };
    </script>

    <!-- React code block - Pure JavaScript + createElement to avoid SyntaxError -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, onSnapshot, runTransaction } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // Use React global variables (e is short for React.createElement)
        const { createElement: e, useState, useEffect, useContext, createContext, useCallback } = window.React;
        const { createRoot } = window.ReactDOM;

        // =================================================================
        // 1. CONFIGURATION AND INITIALIZATION
        // =================================================================

        // 1.1 App ID (Mandatory for Firestore path isolation)
        const appId = 'AiGameWeb';

        // 1.2 Firebase Configuration (Injected via global variables or User's config)
        let firebaseConfig = null;
        // æ£€æŸ¥æ˜¯å¦åœ¨ Canvas ç¯å¢ƒä¸­è¿è¡Œï¼ˆç”± Canvas æ³¨å…¥ __firebase_configï¼‰
        if (typeof __firebase_config !== 'undefined') {
            try {
                firebaseConfig = JSON.parse(__firebase_config);
            } catch (error) {
                console.error("Failed to parse Canvas Firebase config:", error);
                firebaseConfig = {};
            }
        } else {
            // --- é‡è¦ï¼šåœ¨æ­¤å¤„ç²˜è´´æ‚¨è‡ªå·±çš„ Firebase é…ç½®å¯¹è±¡ ---
            // å¦‚æœæ‚¨åœ¨ Canvas å¤–éƒ¨è¿è¡Œæ­¤åº”ç”¨ï¼ˆä¾‹å¦‚åœ¨ GitHub Pagesï¼‰ï¼Œæ‚¨å¿…é¡»ç”¨
            // æ‚¨çš„å®é™… Firebase é¡¹ç›®é…ç½®æ›¿æ¢ä¸‹é¢çš„å ä½ç¬¦ã€‚
            // è¯·ä»æ‚¨çš„ Firebase æ§åˆ¶å°è·å–è¿™äº›å€¼ã€‚
            firebaseConfig = {
                apiKey: "AIzaSyD0kALHxst8sqHLLhPNpRyuu-6VOD1tlHo",
                authDomain: "aigame-store.firebaseapp.com",
                projectId: "aigame-store",
                storageBucket: "aigame-store.firebasestorage.app",
                messagingSenderId: "227975426620",
                appId: "1:227975426620:web:cac0a0ad8d8cea87de0939"
            };

            // è­¦å‘Šç”¨æˆ·å¦‚æœä»–ä»¬å¿˜è®°æ›¿æ¢å ä½ç¬¦
            if (firebaseConfig.projectId === "YOUR_PROJECT_ID") {
                console.error("FIREBASE é…ç½®é”™è¯¯ï¼šè¯·å°†æ­¤å¤„çš„å ä½ç¬¦é…ç½®æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„ Firebase é¡¹ç›®é…ç½®å‡­æ®ã€‚");
                // ç¡®ä¿åœ¨å¤–éƒ¨è¿è¡Œæ—¶ï¼Œå¦‚æœæœªé…ç½®åˆ™ä½¿ç”¨ç©ºå¯¹è±¡ä»¥é˜²æ­¢å´©æºƒï¼Œä½†ä¼šè®°å½•é”™è¯¯ã€‚
                firebaseConfig = {};
            }
            // --- é…ç½®å—ç»“æŸ ---
        }
        // ç¡®ä¿ firebaseConfig ä¸ä¸ºç©ºï¼Œå³ä½¿åœ¨å¤–éƒ¨æœªé…ç½®æ—¶ã€‚
        if (!firebaseConfig) {
            firebaseConfig = {};
        }

        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Initialize Firebase services
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Contexts
        const AuthContext = createContext(null);
        const CurrencyContext = createContext(null);

        // =================================================================
        // 2. AUTHENTICATION PROVIDER (AuthProvider)
        // =================================================================

        const AuthProvider = ({ children }) => {
            const [userId, setUserId] = useState(null);
            const [isAuthReady, setIsAuthReady] = useState(false);

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        if (initialAuthToken) {
                            // Sign in using the provided custom token
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            // Fallback to anonymous sign-in for public access
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Firebase sign-in failed:", error);
                    }
                };

                // Listen for auth state changes to get the final UID
                const unsubscribe = onAuthStateChanged(auth, (user) => {
                    if (user) {
                        setUserId(user.uid);
                    } else {
                        // If sign-in fails, use a random ID as fallback
                        setUserId(crypto.randomUUID());
                    }
                    setIsAuthReady(true);
                });

                initAuth();
                return () => unsubscribe();
            }, []);

            // Use createElement instead of JSX
            return e(
                AuthContext.Provider,
                { value: { userId, db, isAuthReady } },
                children
            );
        };

        // =================================================================
        // 3. CURRENCY AND INVENTORY MANAGEMENT (CurrencyProvider)
        // =================================================================

        const AD_LIMIT_PER_DAY = 5;
        const COIN_PER_AD = 10;
        const INITIAL_BALANCE = 100;

        const CurrencyProvider = ({ children }) => {
            const { userId, db, isAuthReady } = useContext(AuthContext);
            const [balance, setBalance] = useState(0);
            const [inventory, setInventory] = useState({});
            const [adsWatchedToday, setAdsWatchedToday] = useState(0);
            const [loading, setLoading] = useState(true);

            // Firestore Document Reference Path function
            const getProfileRef = useCallback((id) => {
                if (!db || !id) return null;
                // Private Data Path: /artifacts/{appId}/users/{userId}/data/profile
                return doc(db, 'artifacts', appId, 'users', id, 'data', 'profile');
            }, [db]);

            // Real-time data synchronization and initialization
            useEffect(() => {
                if (!isAuthReady || !userId) return;

                const profileRef = getProfileRef(userId);
                if (!profileRef) return;

                // Real-time listener
                const unsubscribe = onSnapshot(profileRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        const today = new Date().toDateString();
                        const lastAd = new Date(data.lastAdDate || 0).toDateString();

                        // Daily ad reset logic
                        let currentAdsWatched = data.adsWatchedToday || 0;
                        if (lastAd !== today) {
                            currentAdsWatched = 0; // Reset count for a new day
                        }

                        setBalance(data.balance || 0);
                        setInventory(data.inventory || {});
                        setAdsWatchedToday(currentAdsWatched);
                    } else {
                        // Initialize data if document doesn't exist
                        setBalance(INITIAL_BALANCE);
                        setInventory({});
                        setAdsWatchedToday(0);

                        // Create the initial document
                        setDoc(profileRef, {
                            balance: INITIAL_BALANCE,
                            inventory: {},
                            lastAdDate: new Date(0).toISOString(),
                            adsWatchedToday: 0,
                        }, { merge: true }).catch(err => console.error("Failed to create initial data:", err));
                    }
                    setLoading(false);
                }, (error) => {
                    console.error("Firestore listener failed:", error);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [isAuthReady, userId, getProfileRef]);

            // Function to watch ad and get coins (with daily limit)
            const watchAd = async () => {
                if (!userId || adsWatchedToday >= AD_LIMIT_PER_DAY) {
                    alert("ä»Šæ—¥å¹¿å‘Šæ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œè¯·æ˜å¤©å†è¯•ï¼");
                    return false;
                }

                const profileRef = getProfileRef(userId);
                if (!profileRef) return false;

                console.log("Simulating ad playback...");
                await new Promise(resolve => setTimeout(resolve, 1500));

                try {
                    await runTransaction(db, async (transaction) => {
                        const docSnap = await transaction.get(profileRef);
                        if (!docSnap.exists()) throw new Error("ç”¨æˆ·æ•°æ®ä¸å­˜åœ¨");

                        const data = docSnap.data();
                        const today = new Date().toDateString();
                        const lastAd = new Date(data.lastAdDate || 0).toDateString();

                        let newAdsWatched = data.adsWatchedToday || 0;
                        if (lastAd !== today) newAdsWatched = 0;

                        if (newAdsWatched >= AD_LIMIT_PER_DAY) throw new Error("å·²è¶…è¿‡ä»Šæ—¥é™åˆ¶");

                        transaction.update(profileRef, {
                            balance: (data.balance || 0) + COIN_PER_AD,
                            adsWatchedToday: newAdsWatched + 1,
                            lastAdDate: new Date().toISOString(),
                        });
                    });
                    alert(`æ­å–œï¼è·å¾— ${COIN_PER_AD} è™šæ‹Ÿå¸å¥–åŠ±ï¼`);
                    return true;
                } catch (e) {
                    console.error("Ad transaction failed:", e);
                    alert(`å¥–åŠ±å‘æ”¾å¤±è´¥: ${e.message || e}`);
                    return false;
                }
            };

            // Function to buy coins (simulated real-money transaction)
            const buyCoins = async (amount, realCost) => {
                if (!userId) return alert("è¯·å…ˆç™»å½•ã€‚");
                const profileRef = getProfileRef(userId);
                if (!profileRef) return false;

                console.log(`Simulating payment: Buying ${amount} coins for Â¥ ${realCost}...`);
                await new Promise(resolve => setTimeout(resolve, 1000));

                try {
                    await runTransaction(db, async (transaction) => {
                        const docSnap = await transaction.get(profileRef);
                        if (!docSnap.exists()) throw new Error("ç”¨æˆ·æ•°æ®ä¸å­˜åœ¨");

                        const currentBalance = docSnap.data().balance || 0;

                        transaction.update(profileRef, {
                            balance: currentBalance + amount,
                        });
                    });

                    alert(`è´­ä¹°æˆåŠŸï¼è·å¾— ${amount} è™šæ‹Ÿå¸ï¼`);
                    return true;
                } catch (e) {
                    console.error("Coin purchase failed:", e);
                    alert("è´­ä¹°å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚");
                    return false;
                }
            };

            // Function to buy an item using virtual currency
            const buyItem = async (itemId, cost) => {
                if (!userId) return alert("è¯·å…ˆç™»å½•ã€‚");
                const profileRef = getProfileRef(userId);
                if (!profileRef) return false;

                try {
                    await runTransaction(db, async (transaction) => {
                        const docSnap = await transaction.get(profileRef);
                        if (!docSnap.exists()) throw new Error("ç”¨æˆ·æ•°æ®ä¸å­˜åœ¨");

                        const currentBalance = docSnap.data().balance || 0;
                        if (currentBalance < cost) throw new Error("ä½™é¢ä¸è¶³");

                        // Update balance and inventory
                        const newInventory = { ...docSnap.data().inventory };
                        newInventory[itemId] = (newInventory[itemId] || 0) + 1;

                        transaction.update(profileRef, {
                            balance: currentBalance - cost,
                            inventory: newInventory,
                        });
                    });

                    if (cost > 0) {
                        alert(`è´­ä¹°æˆåŠŸï¼è·å¾—é“å…·: ${itemId}`);
                    }
                    return true;
                } catch (e) {
                    console.error("Item purchase failed:", e);
                    alert(`æ“ä½œå¤±è´¥: ${e.message || e}`);
                    return false;
                }
            };

            // Function to consume an item
            const useItem = async (itemId) => {
                if (!userId) return alert("è¯·å…ˆç™»å½•ã€‚");
                const profileRef = getProfileRef(userId);
                if (!profileRef) return false;

                try {
                    await runTransaction(db, async (transaction) => {
                        const docSnap = await transaction.get(profileRef);
                        if (!docSnap.exists()) throw new Error("ç”¨æˆ·æ•°æ®ä¸å­˜åœ¨");

                        const currentInventory = docSnap.data().inventory || {};
                        if ((currentInventory[itemId] || 0) <= 0) throw new Error("åº“å­˜ä¸è¶³");

                        // Decrement inventory
                        const newInventory = { ...currentInventory };
                        newInventory[itemId] = newInventory[itemId] - 1;

                        transaction.update(profileRef, {
                            inventory: newInventory,
                        });
                    });
                    return true;
                } catch (e) {
                    console.error("Item consumption failed:", e);
                    alert(`æ¶ˆè€—å¤±è´¥: ${e.message || e}`);
                    return false;
                }
            }

            const contextValue = {
                balance,
                inventory,
                watchAd,
                buyCoins,
                buyItem,
                useItem,
                adsWatchedToday,
                AD_LIMIT_PER_DAY,
                loading,
                userId,
            };

            // Use createElement instead of JSX
            return e(
                CurrencyContext.Provider,
                { value: contextValue },
                children
            );
        };

        // Hook to use currency system
        const useCurrency = () => useContext(CurrencyContext);

        // =================================================================
        // 4. REACT COMPONENTS (Pure JS with createElement)
        // =================================================================

        // Item Shop Component (Store)
        const Store = () => {
            const { buyItem, inventory, adsWatchedToday, AD_LIMIT_PER_DAY, watchAd, buyCoins } = useCurrency();

            const shopItems = [
                { id: 'shield', name: 'æ°¸ä¹…æŠ¤ç›¾', cost: 150, description: 'åœ¨æ˜Ÿé™…èº²é¿ä¸­æ‹¥æœ‰é¢å¤–ä¸€æ¬¡æŠ¤ç›¾' },
                { id: 'speed_boost', name: 'é€Ÿåº¦è¯æ°´', cost: 50, description: 'è´ªåƒè›‡æ¸¸æˆå¼€å±€é€Ÿåº¦æé«˜' },
                { id: 'cosmetic_skin', name: 'é£èˆ¹çš®è‚¤', cost: 200, description: 'è§£é”é£èˆ¹çš„ç‚«é…·çš®è‚¤' },
            ];

            const coinPacks = [
                { amount: 50, cost: 0.99 },
                { amount: 120, cost: 1.99 },
                { amount: 300, cost: 4.99 },
            ];

            // Render Coin Packs Section
            const renderCoinPacks = () => e('section', null,
                e('h3', { className: 'text-xl font-semibold mb-3 text-indigo-400' }, 'ğŸ’° è´­ä¹°è™šæ‹Ÿå¸ (RMB)'),
                e('div', { className: 'space-y-3' },
                    coinPacks.map(pack => e('button', {
                        key: pack.amount,
                        onClick: () => buyCoins(pack.amount, pack.cost),
                        className: 'w-full flex justify-between items-center p-3 rounded-lg bg-indigo-600 hover:bg-indigo-500 transition duration-150 shadow-md text-white font-medium'
                    },
                        e('span', null, `${pack.amount} è™šæ‹Ÿå¸`),
                        e('span', { className: 'text-sm bg-indigo-700 py-1 px-3 rounded-full' }, `Â¥ ${pack.cost}`)
                    ))
                )
            );

            // Render Ad Section
            const renderAdSection = () => e('section', null,
                e('h3', { className: 'text-xl font-semibold mb-3 text-pink-400' }, 'ğŸ“º å…è´¹è·å– (çœ‹å¹¿å‘Š)'),
                e('div', { className: 'space-y-3' },
                    e('p', { className: 'text-sm text-gray-400' }, `ä»Šæ—¥å·²çœ‹: ${adsWatchedToday} / ${AD_LIMIT_PER_DAY} æ¬¡`),
                    e('button', {
                        onClick: watchAd,
                        disabled: adsWatchedToday >= AD_LIMIT_PER_DAY,
                        className: `mt-1 w-full p-4 rounded-lg transition duration-150 font-bold ${adsWatchedToday >= AD_LIMIT_PER_DAY
                                ? 'bg-gray-600 text-gray-400 cursor-not-allowed'
                                : 'bg-pink-600 hover:bg-pink-500 text-white shadow-lg'
                            }`
                    }, adsWatchedToday >= AD_LIMIT_PER_DAY ? 'ä»Šæ—¥é¢åº¦å·²ç”¨å®Œ' : `è§‚çœ‹å¹¿å‘Š (å¾— ${COIN_PER_AD} å¸)`),
                    e('p', { className: 'text-xs text-gray-500 mt-2' }, 'ï¼ˆæ­¤æ“ä½œå°†æ›´æ–°æ‚¨çš„ Firestore è´¦æˆ·æ•°æ®ï¼‰')
                )
            );

            // Render Items Section
            const renderShopItems = () => e('div', { className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4' },
                shopItems.map(item => e('div', { key: item.id, className: 'p-4 bg-gray-700/70 rounded-lg border border-gray-600' },
                    e('h4', { className: 'font-semibold text-lg text-cyan-400' }, item.name),
                    e('p', { className: 'text-sm text-gray-400 mb-3' }, item.description),
                    e('div', { className: 'flex justify-between items-center' },
                        e('span', { className: 'text-base font-bold text-yellow-300' }, `${item.cost} å¸`),
                        e('button', {
                            onClick: () => buyItem(item.id, item.cost),
                            className: 'bg-cyan-600 text-white px-4 py-2 rounded-lg hover:bg-cyan-500 transition duration-150 text-sm'
                        }, `è´­ä¹° (åº“å­˜: ${inventory[item.id] || 0})`)
                    )
                ))
            );

            // Store Top-level Render
            return e('div', { className: 'p-6 bg-gray-800/50 rounded-xl shadow-lg border border-gray-700/50 backdrop-blur-md' },
                e('h2', { className: 'text-2xl font-bold mb-4 text-white' }, 'è™šæ‹Ÿè´§å¸å•†åº—'),
                e('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                    renderCoinPacks(),
                    renderAdSection()
                ),
                e('h3', { className: 'text-2xl font-bold mt-8 mb-4 text-white' }, 'è´­ä¹°æ¸¸æˆé“å…·'),
                renderShopItems()
            );
        };


        // Game Panel Component (GamePanel)
        const GamePanel = () => {
            const { inventory, balance, useItem } = useCurrency();
            const hasShield = inventory['shield'] > 0;
            const hasSpeedBoost = inventory['speed_boost'] > 0;

            const [message, setMessage] = useState('å¼€å§‹æ¸¸æˆ...');

            const handleUseItem = async (itemId) => {
                if (inventory[itemId] > 0) {
                    const success = await useItem(itemId);

                    if (success) {
                        setMessage(`å·²æˆåŠŸæ¶ˆè€—é“å…·: ${itemId}ã€‚æ¸¸æˆå±æ€§å·²ç”Ÿæ•ˆï¼`);
                    } else {
                        setMessage(`é“å…·æ¶ˆè€—å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚`);
                    }
                } else {
                    setMessage(`æ²¡æœ‰ ${itemId} é“å…·äº†ï¼Œå»å•†åº—çœ‹çœ‹å§ã€‚`);
                }
            }

            const renderGameButton = (itemId, name, inventoryCount, hasItem) => e('div', { className: 'p-3 bg-indigo-900/50 rounded-lg' },
                e('p', { className: 'text-lg font-semibold text-white' }, name),
                e('p', { className: 'text-sm text-gray-400' }, `åº“å­˜: ${inventoryCount || 0}`),
                e('button', {
                    onClick: () => handleUseItem(itemId),
                    disabled: !hasItem,
                    className: `mt-2 w-full py-2 rounded ${hasItem ? 'bg-indigo-500 hover:bg-indigo-400' : 'bg-gray-600 text-gray-400 cursor-not-allowed'}`
                }, hasItem ? 'ä½¿ç”¨' + name.split('(')[0].trim() : `æ— ${name.split('(')[0].trim()}`)
            );

            // GamePanel Top-level Render
            return e('div', { className: 'p-6 bg-gray-800/50 rounded-xl shadow-lg border border-gray-700/50 backdrop-blur-md' },
                e('h2', { className: 'text-2xl font-bold mb-4 text-white' }, 'æ¸¸æˆåŒºåŸŸæ¨¡æ‹Ÿ'),
                e('div', { className: 'mb-4 p-4 bg-gray-700 rounded-lg text-lg font-mono text-green-300' }, `å½“å‰ä½™é¢: ${balance} å¸`),
                e('div', { className: 'grid grid-cols-2 gap-4' },
                    renderGameButton('shield', 'æ˜Ÿé™…èº²é¿æŠ¤ç›¾', inventory['shield'], hasShield),
                    renderGameButton('speed_boost', 'éœ“è™¹è´ªåƒè›‡è¯æ°´', inventory['speed_boost'], hasSpeedBoost)
                ),
                e('p', { className: 'mt-4 text-center text-yellow-300' }, message)
            );
        }

        // Main Application Component (App)
        const App = () => {
            const { isAuthReady } = useContext(AuthContext);
            const { loading, userId } = useCurrency();

            if (!isAuthReady || loading) {
                return e('div', { className: 'min-h-screen flex items-center justify-center bg-gray-900 text-white' },
                    e('div', { className: 'animate-pulse' }, 'æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...')
                );
            }

            // Header Render
            const renderHeader = () => e('header', { className: 'text-center mb-8' },
                e('h1', { className: 'text-4xl font-extrabold text-white mb-2' }, 'AI æ¸¸æˆç›ˆåˆ©ç³»ç»Ÿæ¼”ç¤º'),
                e('p', { className: 'text-sm text-gray-500' },
                    'å½“å‰ç”¨æˆ· ID: ',
                    e('span', { className: 'text-yellow-400 break-all' }, userId)
                )
            );

            // Footer Render
            const renderFooter = () => e('footer', { className: 'text-center text-gray-600 pt-8' },
                e('p', null, 'æ•°æ®å®æ—¶åŒæ­¥äº Firestore æ•°æ®åº“ã€‚')
            );

            // App Top-level Render
            return e('div', { className: 'min-h-screen bg-gray-900 p-8' },
                renderHeader(),
                e('main', { className: 'max-w-4xl mx-auto space-y-8' },
                    e(Store, null),
                    e(GamePanel, null)
                ),
                renderFooter()
            );
        };

        // Ensure React application is rendered after the page loads
        window.onload = function () {
            const rootElement = document.getElementById('root');
            if (!rootElement) {
                console.error("æ— æ³•æ‰¾åˆ° #root å…ƒç´ ã€‚");
                return;
            }

            // Use the new React 18 API to render the app wrapped in providers
            createRoot(rootElement).render(
                e(AuthProvider, null,
                    e(CurrencyProvider, null,
                        e(App, null)
                    )
                )
            );
        }
    </script>
</body>
</html>